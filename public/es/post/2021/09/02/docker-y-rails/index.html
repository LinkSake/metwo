<!DOCTYPE html>
<html lang="es-MX">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="manifest" href="/images/site.webmanifest">

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="¬øLos nuevos desarrolladores de tu equipo tardan semanas en poder correr el proyecto? ¬øHacer que el proyecto llegue a producci√≥n es una odisea? Tal vez Docker sea la soluci√≥n.">
    
    <title>
      
        Docker &#43; Rails: Una soluci√≥n para tus dolores de cabeza
      
      | luis angel ortega
    </title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    <link rel="stylesheet" href="http://localhost:1313/css/theme-override.css">
    <header>

  <nav>
    <ul>
      
      
      
      
      <li class="pull-left ">
        <a href="http://localhost:1313/es">~/inicio</a>
      </li>
      
      
      <li class="pull-left ">
        <a href="http://localhost:1313/es/categories/">~/escritos</a>
      </li>
      
      
      <li class="pull-left ">
        <a href="http://localhost:1313/es/projects">~/proyectos</a>
      </li>
      
      
      <li class="pull-left ">
        <a href="http://localhost:1313/es/garden">~/jardin</a>
      </li>
      
      
      <li class="pull-left ">
        <a href="http://localhost:1313/es/about">~/sobre-mi</a>
      </li>
      

      
      
      <li class="pull-right">
        <a href="https://vmst.io/@link">~/mastodon</a>
      </li>
      
      
      <li class="pull-right">
        <a href="http://localhost:1313/es/post/index.xml">~/rss</a>
      </li>
      

    </ul>
  </nav>
</header>

  </head>

  <body>
    <br/>

<div class="article-meta">
  <h1><span class="title">Docker + Rails: Una soluci√≥n para tus dolores de cabeza</span></h1>
  <div class="after-title">
    
      por <span class="author">Luis Angel Ortega</span>
      
        <i class="date">(jueves, 2 de septiembre de 2021)</i>
      
      | 
      2138 palabras / 11 minutos
    
  </div>
</div>



<div class="content-wrapper">
  <main>
    <p>¬øHas llegado a pasar una semana solamente tratando de correr el proyecto al que te acabas de unir? ¬øO tu aplicaci√≥n no corre en producci√≥n como corr√≠a en local?<br>
Hay una multitud de factores que pueden contribuir esto, por ello <a href="https://www.docker.com/">Docker</a> nos ofrece una soluci√≥n con la cual podemos tener un mayor control sobre estas variables a trav√©s de las computadoras que sean necesarias.</p>
<p>Dicho esto, en este articulo veremos como falicitarnos la vida al tener toda nuestra aplicaci√≥n de Ruby on Rails corriendo sobre Docker; incluidas las bases de datos que sean necesarias.</p>
<h2 id="prerequisitos">Prerequisitos</h2>
<p>Para poder seguir esta gu√≠a necesitaras tener <a href="https://docs.docker.com/get-docker/">Docker instalado</a> as√≠ como un proyecto el cual quieras <em>dockerizar</em>, si solamente quieres pr√°cticar puedes usar <a href="https://github.com/LinkSake/docker-rails">este proyecto de ejemplo</a> el cual necesita una conexi√≥n a <a href="https://es.wikipedia.org/wiki/PostgreSQL">Postgres</a> y a <a href="https://es.wikipedia.org/wiki/Redis">Redis</a> para funcionar.</p>
<p>¬øEres impaciente? ¬°Puedes clonar <a href="https://github.com/LinkSake/docker-rails/tree/docker">esta rama</a> del proyecto donde ya se encuentran los archivos necesarios para correr el projecto dentro de Docker!</p>
<h2 id="primero-viene-el-dockerfile">Primero viene el Dockerfile</h2>
<p>Lo primero que haremos ser√° hacer una <a href="https://docs.docker.com/get-started/overview/#docker-objects">imagen</a> personalizada para nuestro proyecto, as√≠ que crearemos un archivo en la ra√≠z del mismo llamado <code>Dockerfile</code></p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>touch Dockerfile
</span></span></code></pre></div><p>La primer linea de nuestro archivo definir√° la imagen de la cual nos basaremos, en este caso ser√° la <a href="https://hub.docker.com/_/ruby">imagen oficial de Ruby</a>, pero usaremos la versi√≥n de <a href="https://es.wikipedia.org/wiki/Alpine_Linux">Alpine</a> para tener una imagen m√°s ligera como resultado.</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#ca9ee6">FROM</span><span style="color:#a6d189"> ruby:3.0.1-alpine</span><span style="color:#e78284">
</span></span></span></code></pre></div><blockquote>
<p>‚ö†Ô∏è Asegurate que la version de Ruby (ruby:X.X.X-alpine) sea la misma que en tu proyecto, o tendr√°s errores a la hora de tratar de construir la imagen. Puedes encontrar la versi√≥n que usa tu proyecto en tu Gemfile.</p>
</blockquote>
<p>Despu√©s sigue la parte m√°s dificil de este Dockerfile, instalar la dependendencias necesarias para que funcione el proyecto; las que se muestran aqu√≠ son las que funcionan para nuestro <a href="https://github.com/LinkSake/docker-rails">proyecto de ejemplo</a>, que incluyen las necesarias para realizar una conexi√≥n con Postgres, pero tendr√°s que descubrir cuales son necesarias para tu proyecto.</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#ca9ee6">FROM</span><span style="color:#a6d189"> ruby:3.0.1-alpine</span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">RUN</span> apk add --update --no-cache --virtual run-dependencies <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>build-base <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>postgresql-client <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>postgresql-dev <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>yarn <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>git <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>tzdata <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>libpq <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span><span style="color:#99d1db;font-weight:bold">&amp;&amp;</span> rm -rf /var/cache/apk/*<span style="color:#e78284">
</span></span></span></code></pre></div><blockquote>
<p>Puedes esperar a construir la imagen (<code>docker build .</code>) para revisar el error que imprima Docker, con eso podr√°s ir averiguando que depenencias hacen falta üòâ</p>
</blockquote>
<p>La √∫ltima linea (<code>rm -rf /var/cache/apk/*</code>) borra los paquetes de las dependencias que acabamos de instalar, esto ahorrar√° espacio en la imagen.</p>
<p>Lo siguiente que debemos de realizar es crear un directorio dentro del contenedor donde podamos copiar el c√≥digo de nuestra aplicaci√≥n para su ejecuci√≥n, eso lo haremos con el siguente comando dentro de nuestro Dockerfile.</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#ca9ee6">FROM</span><span style="color:#a6d189"> ruby:3.0.1-alpine</span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">RUN</span> apk add --update --no-cache  --virtual run-dependencies <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>build-base <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>postgresql-client <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>postgresql-dev <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>yarn <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>git <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>tzdata <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>libpq <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span><span style="color:#99d1db;font-weight:bold">&amp;&amp;</span> rm -rf /var/cache/apk/*<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">WORKDIR</span><span style="color:#a6d189"> /docker-rails</span><span style="color:#e78284">
</span></span></span></code></pre></div><blockquote>
<p>¬°Recuerda cambiar el <code>docker-rails</code> por el nombre de tu proyecto!</p>
</blockquote>
<p>As√≠ como le dimos un hogar a tu proyecto dentro del contenedor que crearemos, las gemas del mismo necesitan una carpeta tambi√©n. Por ello, le informaremos a <a href="https://bundler.io/es/">bundler</a> donde colocarlas a trav√©s de una variable de ambiente.</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#ca9ee6">FROM</span><span style="color:#a6d189"> ruby:3.0.1-alpine</span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">RUN</span> apk add --update --no-cache  --virtual run-dependencies <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>build-base <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>postgresql-client <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>postgresql-dev <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>yarn <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>git <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>tzdata <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>libpq <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span><span style="color:#99d1db;font-weight:bold">&amp;&amp;</span> rm -rf /var/cache/apk/*<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">WORKDIR</span><span style="color:#a6d189"> /docker-rails</span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">ENV</span> BUNDLE_PATH /gems<span style="color:#e78284">
</span></span></span></code></pre></div><p>Y aunque ya instalamos las dependencias necesarias para correr Rails dentro del contenedor, tu proyecto necesitar√° algunas gemas y algunos paquetes de JavaScript para funcionar de manera correcta, vamos a encargarnos de eso de la siguiente manera.</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#ca9ee6">FROM</span><span style="color:#a6d189"> ruby:3.0.1-alpine</span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">RUN</span> apk add --update --no-cache  --virtual run-dependencies <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>build-base <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>postgresql-client <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>postgresql-dev <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>yarn <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>git <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>tzdata <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>libpq <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span><span style="color:#99d1db;font-weight:bold">&amp;&amp;</span> rm -rf /var/cache/apk/*<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">WORKDIR</span><span style="color:#a6d189"> /docker-rails</span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">ENV</span> BUNDLE_PATH /gems<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">COPY</span> package.json yarn.lock /docker-rails/<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">RUN</span> yarn install<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">COPY</span> Gemfile Gemfile.lock /docker-rails/<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">RUN</span> bundle install<span style="color:#e78284">
</span></span></span></code></pre></div><p>Ahora que ya tenemos todo lo necesario para que funcione tu proyecto, vamos a copiar el c√≥digo al contenedor dentro de la que carpeta que creamos con el comando <code>WORKDIR</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#ca9ee6">FROM</span><span style="color:#a6d189"> ruby:3.0.1-alpine</span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">RUN</span> apk add --update --no-cache  --virtual run-dependencies <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>build-base <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>postgresql-client <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>postgresql-dev <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>yarn <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>git <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>tzdata <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>libpq <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span><span style="color:#99d1db;font-weight:bold">&amp;&amp;</span> rm -rf /var/cache/apk/*<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">WORKDIR</span><span style="color:#a6d189"> /docker-rails</span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">ENV</span> BUNDLE_PATH /gems<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">COPY</span> package.json yarn.lock /docker-rails/<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">RUN</span> yarn install<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">COPY</span> Gemfile Gemfile.lock /docker-rails/<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">RUN</span> bundle install<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">COPY</span> . /docker-rails/<span style="color:#e78284">
</span></span></span></code></pre></div><blockquote>
<p>¬øPor qu√© copiamos primero los manifiestos (package.json, Gemfile, etc.) y despu√©s el resto del proyecto? Esto nos evita tener que reinstalar las dependencias (dado a que se quedan en cach√©) despu√©s de cambiar el c√≥digo base y reconstruir la imagen; de esta manera solo cuando cambien los manifiestos se volver√° a correr sus comandos de instalaci√≥n.</p>
</blockquote>
<p>Finalmente le diremos a Docker que comando correr cuando iniciemos nuestro contenedor (<code>rails</code>), as√≠ como los argumentos de este (<code>s -b 0.0.0.0</code>) y que puerto exponer para que nosotros podamos accesar a nuestra aplicaci√≥n.</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Dockerfile" data-lang="Dockerfile"><span style="display:flex;"><span><span style="color:#ca9ee6">FROM</span><span style="color:#a6d189"> ruby:3.0.1-alpine</span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">RUN</span> apk add --update --no-cache  --virtual run-dependencies <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>build-base <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>postgresql-client <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>postgresql-dev <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>yarn <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>git <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>tzdata <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span>libpq <span style="color:#8caaee">\
</span></span></span><span style="display:flex;"><span><span style="color:#8caaee"></span><span style="color:#99d1db;font-weight:bold">&amp;&amp;</span> rm -rf /var/cache/apk/*<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">WORKDIR</span><span style="color:#a6d189"> /docker-rails</span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">ENV</span> BUNDLE_PATH /gems<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">COPY</span> package.json yarn.lock /docker-rails/<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">RUN</span> yarn install<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">COPY</span> Gemfile Gemfile.lock /docker-rails/<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">RUN</span> bundle install<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">COPY</span> . /docker-rails/<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">ENTRYPOINT</span> [<span style="color:#a6d189">&#34;bin/rails&#34;</span>]<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">CMD</span> [<span style="color:#a6d189">&#34;s&#34;</span>, <span style="color:#a6d189">&#34;-b&#34;</span>, <span style="color:#a6d189">&#34;0.0.0.0&#34;</span>]<span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284">
</span></span></span><span style="display:flex;"><span><span style="color:#e78284"></span><span style="color:#ca9ee6">EXPOSE</span><span style="color:#a6d189"> 3000</span><span style="color:#e78284">
</span></span></span></code></pre></div><blockquote>
<p>El puerto default sobre el que Rails corre es el 3000, pero si has designado otro puerto dentro de tu aplicaci√≥n asegurarte de exponerlo de manera correcta.</p>
</blockquote>
<p>Y con esto tenemos listo nuestro Dockerfile, aunque estamos lejos de tener nuestra aplicaci√≥n lista. Si construyeramos nuestra imagen con <code>docker build .</code> y trataramos de correrla con <code>docker start docker-rails</code> nos encontrar√≠amos con un error, ya que Rails no encuentra las bases de datos que necesita para iniciar de manera correcta; pero pronto nos encargaremos de ello.</p>
<h2 id="luego-el-docker-composeyml">Luego el docker-compose.yml</h2>
<p>Para poder coordinar todos los servicios que necesitamos para el correcto funcionamiento de nuestra aplicaci√≥n (en este caso 2 bases de datos: Posgres y Redis) usaremos <a href="https://docs.docker.com/compose/">docker-compose</a>, esta √∫tilidad de Docker nos ayudar√° a crear multimples contenedores de diferentes imagenes, <a href="https://docs.docker.com/compose/networking/">conectarlos</a>, darles <a href="https://docs.docker.com/compose/environment-variables/">variables de ambiente</a> e incluso <a href="https://docs.docker.com/storage/volumes/">volumenes</a>.</p>
<p>Empezaremos creando un archivo llamado <code>docker-compose.yml</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>touch docker-compose.yml
</span></span></code></pre></div><p>Y en su primera linea especificaremos que <a href="https://docs.docker.com/compose/compose-file/#compose-and-docker-compatibility-matrix">versi√≥n</a> de la herramienta queremos usar, en este caso usaremos la m√°s reciente a la redacci√≥n de este articulo.</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ca9ee6">version</span>: <span style="color:#a6d189">&#39;3.8&#39;</span>
</span></span></code></pre></div><p>Despu√©s indicaremos los servicios que queremos que corra docker-compose, esto lo haremos dentro de la etiqueta <code>services</code>. A cada servicio le daremos un nombre el cual ser√° importante cuando estemos configurando nuestra imagen as√≠ que asegurate de nombrarlo de una manera que haga sentido para ti. Vamos como primer ejemplo servicio de Posgres, al cual llamaremos <em>db</em>.</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ca9ee6">version</span>: <span style="color:#a6d189">&#39;3.8&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">db</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">image</span>: postgres:latest
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">container_name</span>: docker-rails-db
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">environment</span>:
</span></span><span style="display:flex;"><span>      - POSTGRES_DB=docker-rails-dev
</span></span><span style="display:flex;"><span>      - POSTGRES_PASSWORD=password
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ef9f76">5432</span>:<span style="color:#ef9f76">5432</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#a6d189">&#39;dbdata:/var/lib/postgresql/data&#39;</span>
</span></span></code></pre></div><blockquote>
<p>Los archivos YAML son sensibles a la identaci√≥n, as√≠ que asegurate de tener todo en orden y andidado de forma correcta.</p>
</blockquote>
<p>La etiqueta <code>db</code> es el nombre que le dimos al servicio y dentro de la cual especificaremos toda la configuraci√≥n del mismo.</p>
<p>Lo primero con lo que nos encontramos es <code>image</code> que tal como su nombre lo indica es el nombre de la imagen que queremos usar para ese servicio, en este caso es la imagen oficial de Posgres en su √∫ltima versi√≥n (puedes especificar una versi√≥n remplazando el <code>latest</code> por alguna otra versi√≥n v√°lida).</p>
<p>Despu√©s nos encontramos con <code>container_name</code>, que tambi√©n es autodescriptivo y el cual vendra √∫til a la hora de checar nuestros contendores con <code>docker ps</code>.</p>
<p><code>enviroment</code> se refiere a las variables de ambiente, y si nos referimos a la documentaci√≥n de la imagen de <a href="https://hub.docker.com/_/postgres">Docker de Posgres</a> podemos ver que la √∫nica variable obligatoria es <code>POSTGRES_PASSWORD</code> pero nosotros tambi√©n definiremos <code>POSTGRES_DB</code> para darle un nombre personalizado a la base de datos que crea la imagen por defecto.</p>
<blockquote>
<p>‚ö†Ô∏è ¬°Asegurate de elegir una contrase√±a segura para la base de datos!</p>
</blockquote>
<p><code>ports</code> son los puertos que necesitaremos pasar de dentro del contenedor a nuestra maquina, los indicados en el archivo son los que por defecto usa Posgres.</p>
<p>Finalmente los <code>volumes</code> son la infomaci√≥n persistente que necesitaremos para no correr las migraciones cada vez que encendamos el contenedor, esto porque Docker borra todos los datos una vez que damos de baja la informaci√≥n, si quieres aprender m√°s sobre este tema te recomiendo <a href="https://docs.docker.com/storage/volumes/">esta</a> secci√≥n de la documentaci√≥n.</p>
<p>Ahora, el siguiente servicio es el de Redis pero no ahondaremos mucho en el pues cuenta solo con un par de etiquetas las cuales ya hemos revisado, para m√°s informaci√≥n puedes visitar <a href="https://hub.docker.com/_/redis">la imagen oficial.</a></p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ca9ee6">version</span>: <span style="color:#a6d189">&#39;3.8&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">db</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">image</span>: postgres:latest
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">container_name</span>: docker-rails-db
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">environment</span>:
</span></span><span style="display:flex;"><span>      - POSTGRES_DB=docker-rails-dev
</span></span><span style="display:flex;"><span>      - POSTGRES_PASSWORD=password
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ef9f76">5432</span>:<span style="color:#ef9f76">5432</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#a6d189">&#39;dbdata:/var/lib/postgresql/data&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">redis</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">image</span>: redis:latest
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">container_name</span>: docker-rails-redis
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ef9f76">6379</span>:<span style="color:#ef9f76">6379</span>
</span></span></code></pre></div><p>Nuestro √∫ltimo servicio lo llamaremos <code>web</code> y ser√° la imagen que hemos construido con nuestro <code>Dockerfile</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ca9ee6">version</span>: <span style="color:#a6d189">&#39;3.8&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">db</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">image</span>: postgres:latest
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">container_name</span>: docker-rails-db
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">environment</span>:
</span></span><span style="display:flex;"><span>      - POSTGRES_DB=docker-rails-dev
</span></span><span style="display:flex;"><span>      - POSTGRES_PASSWORD=password
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ef9f76">5432</span>:<span style="color:#ef9f76">5432</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#a6d189">&#39;dbdata:/var/lib/postgresql/data&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">redis</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">image</span>: redis:latest
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">container_name</span>: docker-rails-redis
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ef9f76">6379</span>:<span style="color:#ef9f76">6379</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">web</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">build</span>: .
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">image</span>: docker-rails
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">container_name</span>: docker-rails-web
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ef9f76">3000</span>:<span style="color:#ef9f76">3000</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">depends_on</span>:
</span></span><span style="display:flex;"><span>      - db
</span></span><span style="display:flex;"><span>      - redis
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">environment</span>:
</span></span><span style="display:flex;"><span>      - POSTGRES_HOST=db
</span></span><span style="display:flex;"><span>      - POSTGRES_USER=postgres
</span></span><span style="display:flex;"><span>      - POSTGRES_PASSWORD=password
</span></span><span style="display:flex;"><span>      - REDIS_URL=redis://redis:6379
</span></span></code></pre></div><p>La primer etiqueta nueva con la que nos topamos es <code>build</code>, la cual indica el directorio donde se encuentra nuestro Dockerfile; dado a que nuestro Dockerfile est√° en la ra√≠z solamente pondremos <code>.</code>; si tu Dockerfile no est√° en la ra√≠z o tiene otro nombre es recomendable que leas <a href="https://docs.docker.com/compose/compose-file/compose-file-v3/#build">esta</a> secci√≥n de la documentaci√≥n para asegurarte que Compose lo encuentre.</p>
<p>La etiqueta <code>image</code> en este caso servir√° para nombrar la imagen que construir√° Compose, ya que al estar presente <code>build</code> no ir√° al repositorio a buscar una imagen preconstruida.</p>
<p>Por √∫ltimo, la etiqueta <code>depends_on</code> informar√° a Compose que no se debe de tratar de iniciar el contenedor hasta que est√©n creados los servicios <code>db</code> y <code>redis</code>, as√≠ como los conectar√° de manera interna para que nosotros podamos accesar a ellos mediante un URL (como se puede observar en la variable de ambiente de Redis) o por sus respectivas credenciales (como es el caso de Postgres), si quieres aprender como Docker maneja eso puedes leer sobre <a href="https://docs.docker.com/compose/networking/">Docker Network</a>.</p>
<p>Ahora que ya terminamos con los servicios, lo unico que debemos es listar los volumenes que usaremos y a los cuales <a href="https://docs.docker.com/compose/compose-file/compose-file-v3/#volumes">nombramos</a> de la siguiente manera.</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ca9ee6">version</span>: <span style="color:#a6d189">&#39;3.8&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">db</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">image</span>: postgres:latest
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">container_name</span>: docker-rails-db
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">environment</span>:
</span></span><span style="display:flex;"><span>      - POSTGRES_DB=docker-rails-dev
</span></span><span style="display:flex;"><span>      - POSTGRES_PASSWORD=password
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ef9f76">5432</span>:<span style="color:#ef9f76">5432</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#a6d189">&#39;dbdata:/var/lib/postgresql/data&#39;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">redis</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">image</span>: redis:latest
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">container_name</span>: docker-rails-redis
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ef9f76">6379</span>:<span style="color:#ef9f76">6379</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">web</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">build</span>: .
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">image</span>: docker-rails
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">container_name</span>: docker-rails-web
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ef9f76">3000</span>:<span style="color:#ef9f76">3000</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">depends_on</span>:
</span></span><span style="display:flex;"><span>      - db
</span></span><span style="display:flex;"><span>      - redis
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">environment</span>:
</span></span><span style="display:flex;"><span>      - POSTGRES_HOST=db
</span></span><span style="display:flex;"><span>      - POSTGRES_USER=postgres
</span></span><span style="display:flex;"><span>      - POSTGRES_PASSWORD=password
</span></span><span style="display:flex;"><span>      - REDIS_URL=redis://redis:6379
</span></span><span style="display:flex;"><span>    <span style="color:#ca9ee6">volumes</span>:
</span></span><span style="display:flex;"><span>      - .:/app
</span></span><span style="display:flex;"><span><span style="color:#ca9ee6">volumes</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ca9ee6">dbdata</span>:
</span></span></code></pre></div><p>¬°Y listo! Nuestro <code>docker-compose.yml</code> est√° listo, ahora solo falta un paso para empezar a crear nuestra aplicaci√≥n contenida en Docker.</p>
<h2 id="ojos-que-no-ven-dockerignore-que-no-siente">Ojos que no ven, .dockerignore que no siente</h2>
<p>Muchas veces no queremos que ciertos archivos est√©n en nuestra imagen de Docker pues estos no son necesarios para su contrucci√≥n (o se generan en la misma) y solo terminan haciendo el proyecto m√°s grande de lo que necesita ser, como puede ser el caso de los <code>node_modules</code> y la carpeta <code>.git</code>.<br>
Para ahorrarnos este espacio crearemos un archivo llamado <code>.dockerignore</code> en la ra√≠z de nuestro proyecto y a√±adiremos estas dos carpetas:</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#99d1db">echo</span> <span style="color:#a6d189">&#34;.git \n node_modules&#34;</span> &gt;&gt; .dockerignore
</span></span></code></pre></div><p>Para m√°s informaci√≥n sobre lo que puede contenener un archivo <code>.dockerignore</code> puedes consultar la <a href="https://docs.docker.com/engine/reference/builder/#dockerignore-file">documentaci√≥n oficial de Docker</a></p>
<h2 id="unas-bases-de-datos-para-llevar">Unas bases de datos para llevar</h2>
<p>Antes de correr el proyecto ser√° necesario crear la base de datos que Rails espera, y crearla es tan sencillo que se puede hacer en un solo comando.</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker-compose run web db:create
</span></span></code></pre></div><p>Este comando le dice a Docker que use la imagen (que construir√°) para correr un comando, en este caso <code>db:create</code>. Docker, con lo especificado en el <code>docker-compose.yml</code> sabe que como <em>web</em> depende de <em>db</em> tendr√° que correr primero la instancia de Postgres, por lo que la base de datos se crear√° en este contenedor.</p>
<blockquote>
<p>¬øPor qu√© solamente <code>db:create</code> y no <code>rails db:create</code> o <code>rake db:create</code>? En nuestro <code>Dockerfile</code> dimos como punto de entrada el comando <code>rails</code>, por ello solo es necesario pasar los parametros. Si quisieramos efectuar otro comando dentro del contenedor esto tendr√≠a que ser a trav√©s de <a href="https://docs.docker.com/engine/reference/commandline/exec/">docker exec</a>.</p>
</blockquote>
<h2 id="nuestra-aplicaci√≥n-en-un-contenedor">Nuestra aplicaci√≥n en un contenedor</h2>
<p>Con la base de datos creada, solo queda un comando que corra los contenedores en <a href="https://docs.docker.com/compose/reference/up/">modo separado</a> y podremos ver el fruto de nuestro trabajo.</p>
<div class="highlight"><pre tabindex="0" style="color:#c6d0f5;background-color:#303446;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker-compose up -d
</span></span></code></pre></div><p>¬°Y listo! Ya podr√°s accesar a traves de tu navegador a <a href="http://localhost:3000/">localhost:3000</a> y ver la p√°gina de bienvenida de Rails.</p>
<p><img alt="Welcome to Rails!" src="/images/post/docker-rails-1.png"></p>
<h2 id="conclusi√≥n">Conclusi√≥n</h2>
<p>Puede que todo este proceso sea algo intimidante al principio, en especial si no sabes Docker, pero su resultado es un ambiente de desarrollo mucho m√°s sencillo para todos los involucrados en el proyecto, pues ahora solo con tener Docker instalado podr√°n iniciar a programar; sin mencionar los beneficios que esta tecnolog√≠a puede traer a tu ambiente de producci√≥n cuando se combina con Kubernetes o Docker Swarm.</p>
<p>Espero que te haya sido √∫til, cualquier cosa puedes <a href="https://luisangel.me/es/about">contactarme</a> y responder√© lo m√°s pronto posible.</p>
<h2 id="referencias">Referencias</h2>
<ul>
<li><a href="https://docs.docker.com/samples/rails/">Docker Docs</a></li>
<li><a href="https://gorails.com/episodes/docker-basics-for-gorails">Go Rails</a></li>
</ul>

    
      <p class="terms-single">„Äå
        
          
          <span>
            Categor√≠as: 
          </span>
              <a href="http://localhost:1313/es/categories/articulos">Articulos</a> 
            
          
        
          
          <span>
            Etiquetas: 
          </span>
              <a href="http://localhost:1313/es/tags/rails">rails</a> 
            
          </span>
              <a href="http://localhost:1313/es/tags/docker">docker</a> 
            
          </span>
              <a href="http://localhost:1313/es/tags/desarrollo-web">desarrollo web</a> 
            
          
        
        „Äç</p>
      
  </main>
</div>
    <footer>
      
<script>
(function() {
  function center_el(tagName) {
    var tags = document.getElementsByTagName(tagName), i, tag;
    for (i = 0; i < tags.length; i++) {
      tag = tags[i];
      var parent = tag.parentElement;
      
      if (parent.childNodes.length === 1) {
        
        if (parent.nodeName === 'A') {
          parent = parent.parentElement;
          if (parent.childNodes.length != 1) continue;
        }
        if (parent.nodeName === 'P') parent.style.textAlign = 'center';
      }
    }
  }
  var tagNames = ['img', 'embed', 'object'];
  for (var i = 0; i < tagNames.length; i++) {
    center_el(tagNames[i]);
  }
})();
</script>

      
      <hr/>
      Luis Angel Ortega ¬© 2024 | <a href="/en">English</a> | Hecho con <a href="https://github.com/goodroot/hugo-classic">hugo-classic</a>
      
    </footer>
  </body>
</html>

<a rel="me" href="https://vmst.io/@link" style="display: none;"></a>
